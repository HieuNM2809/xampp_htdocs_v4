<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>OAuth2 Implicit Demo — App</title>
</head>
<body>
<h1>Demo OAuth2 Implicit Grant</h1>
<button id="loginBtn">Login (Implicit)</button>
<pre id="profile"></pre>
<button id="ajaxBtn" style="display:none">Load Ajax Data</button>
<pre id="ajaxData"></pre>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const clientId = 'client1';
    const redirectUri = window.location.origin + '/callback';
    const authServer = 'http://localhost:4000';

    // 1) Click → redirect tới Auth-Server /authorize
    $('#loginBtn').click(() => {
        const url = `${authServer}/authorize` +
            `?response_type=token` +
            `&client_id=${clientId}` +
            `&redirect_uri=${encodeURIComponent(redirectUri)}`;
        window.location = url;
    });

    // 2) Khi Facebook (Auth-Server) redirect về /callback#access_token=…
    if (window.location.pathname === '/callback' && window.location.hash) {
        const params = new URLSearchParams(window.location.hash.slice(1));
        const token = params.get('access_token');
        if (token){
            // 3) Gọi App-Server → /me?access_token=…
            $.get('/me', {access_token: token})
                .done(data => {
                    $('#profile').text(JSON.stringify(data, null, 2));
                    $('#ajaxBtn').show().data('token', token);
                })
                .fail(err => {
                    $('#profile').text('Error: ' + JSON.stringify(err));
                });
		}

    }

    // 4) Khi click nút Ajax → gọi /ajax_data
    $('#ajaxBtn').click(function () {
        const token = $(this).data('token');
        $.get('/ajax_data', {access_token: token})
            .done(data => $('#ajaxData').text(JSON.stringify(data, null, 2)));
    });
</script>
</body>
</html>
